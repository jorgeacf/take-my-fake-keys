# ──────────────────────────────────────────────────────────────
# Honeypot: Serve fake files for common leaked-path probes
# ──────────────────────────────────────────────────────────────

# Dedicated log format with more detail for suspicious requests
log_format suspicious '[$time_iso8601] $remote_addr - $http_user_agent | '
                      'PATH: $request_uri | STATUS: $status | '
                      'REFERER: $http_referer | BYTES: $body_bytes_sent | '
                      'TIME: $request_time sec';

# Separate log file just for honeypot hits (easier to tail/grep/fail2ban)
access_log /var/log/nginx/honeypot.log suspicious;

# ──────────────────────────────────────────────────────────────
# Exact sensitive paths → alias to fake files
# ──────────────────────────────────────────────────────────────

# .env variants and backups
location ~* ^/(\.env|\.env\.(local|production|development|dev|prod|test|staging|backup|bak|old|save|tmp|swp|~)|env|\.e5498)$ {
    alias /opt/honeypot-files$request_uri;
    default_type text/plain;
    expires off;
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    access_log /var/log/nginx/honeypot.log suspicious;
}

# Common config/secrets files (json, yml, py, etc.)
location ~* ^/(config\.json|settings\.json|secrets\.json|appsettings\.json|application\.ya?ml|docker-compose\.ya?ml|terraform\.tf(vars|state)|ecosystem\.config\.js|.aws/credentials|.streamlit/secrets\.toml|wp-config\.php.*)$ {
    alias /opt/honeypot-files$request_uri;
    default_type text/plain;
    expires off;
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    access_log /var/log/nginx/honeypot.log suspicious;
}

# Actuator / debug endpoints (Spring Boot style)
location ~* ^/actuator/(env|configprops)$ {
    alias /opt/honeypot-files$request_uri;
    default_type application/json;
    expires off;
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    access_log /var/log/nginx/honeypot.log suspicious;
}

# Git exposure attempts
location ~* ^/\.git/(config|logs/HEAD)$ {
    alias /opt/honeypot-files$request_uri;
    default_type text/plain;
    expires off;
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    access_log /var/log/nginx/honeypot.log suspicious;
}

# Catch-all for other common probe patterns from your log
# (add more as you see new ones in logs)
location ~* ^/(src|app|backend|frontend|api|server|client|web|public|private|var|config|storage/framework)/\.env$ {
    alias /opt/honeypot-files$request_uri;
    default_type text/plain;
    expires off;
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    access_log /var/log/nginx/honeypot.log suspicious;
}

# Optional: Very broad trap for anything starting with /. or containing .env / secrets
# (use carefully – can catch legitimate weird requests)
# location ~* (^/\.|env|secrets|config|credentials) {
#     alias /opt/honeypot-files$request_uri;
#     ...
# }